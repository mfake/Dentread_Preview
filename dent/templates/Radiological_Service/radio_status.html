{% extends 'dentread_dashbase.html' %}
{% load static %}
{% block content %}
{% if user.is_authenticated %}
<!-- {% comment %}
--------------------////////////////NEW/////////////////----------- 
{% endcomment %} -->

<script src="{% static '/tinymce/tinymce.min.js' %}"></script>
<div class="main-content side-content pt-0">
  <div class="container-fluid">
    <button class="back-button" onclick="history.back()"><i class="fa-solid fa-arrow-left" style="font-size: 1.1rem;"></i></button>
        
    <div class="row mt-2">

      <!-- patient details and order summary starts from here  -->
      <div class="col-sm-10 col-xl-4 ml-auto mr-auto" style="display: flex; flex-direction: column">
        <!-- <div class="fieldset-styles"> -->
        <fieldset class="scheduler-border" id="patient-fieldset" style="flex: 1 1 auto">
          <legend class="scheduler-border">Patient Details</legend>

          <table style="table-layout: auto; width: 100%">
            <tr>
              <th class="table-heading--style">Patient Name:</th>
              <td class="table-data--style">{{patient.name}}</td>
              <th
                class="table-heading--style"
                style="padding-left: 2rem !important"
              >
                Gender:
              </th>
              
              <td class="table-data--style">{{patient.gender}}</td>
             
            </tr>
            <tr>
              <th class="table-heading--style">Location:</th>
              
              <td class="table-data--style">{{patient.address_1}}</td>
             
              <th
                class="table-heading--style"
                style="padding-left: 2rem !important"
              >
                Age:
              </th>
              
              <td class="table-data--style">{{patient.age}}</td>
    
            </tr>
            <tr>
              <th class="table-heading--style">Registration Date:</th>
         
              <td class="table-data--style">{{patient.rdate}}</td>
         
            </tr>
          </table>
        </fieldset>

        <fieldset class="scheduler-border" id='summary-fieldset' style="flex: 1 1 auto">
          <legend class="scheduler-border">Order Summary</legend>

          <table style="table-layout: auto; width: 100%">
            <tr>
              <th class="table-heading--style">Status:</th>
              <td class="table-data--style">{{service_order.status}}</td>
              <th
                class="table-heading--style"
                style="padding-left: 2rem !important"
              >
                Date:
              </th>
              <td class="table-data--style">{{service_order.date}}</td>
            </tr>
            <tr>
              <th class="table-heading--style">Referred to:</th>
              <td class="table-data--style">Dentread</td>
            </tr>
          </table>

          <form style="margin-top: 1rem" method="post" action="/clinicComment/{{service_order.id}}">
            {% csrf_token %}
            <label
              for="comment"
              style="
                font-weight: 500;
                padding: 0.75rem 0.5rem 0 0;
                font-size: 0.82rem;
              "
              >Comment:</label
            >
            <div class="form-group">
              <div class="form-row">
                <div class="col-sm-10">
                  <input
                    type="text"
                    class="form-control"
                    id="comment" name="comment"
                    placeholder="Type comment, question or feedback"
                    style="font-size: 0.8rem; margin-top: -5px"
                  />
                </div>
                <div class="col-sm-2" style="margin-top: -5px">
                  <button type="submit" class="btn btn-primary mb-2">
                    ADD
                  </button>
                </div>
              </div>
            </div>
          </form>

          <form style="margin-top: -1rem">
            <div class="form-group">
              <label
                for="case-chat"
                style="
                  font-weight: 500;
                  padding: 0.75rem 0.5rem 0 0;
                  font-size: 0.82rem;    
                  
                "
                >Case Chat</label
              >
              <div id="case-chat" style='overflow: auto'>
                
              </div>
            </div>
          </form>
        </fieldset>
      </div>

      <!-- order details fieldset starts from  here  -->
      <div class="col-sm-10 col-xl-8 ml-auto mr-auto d-flex">
        <fieldset class="scheduler-border" id="order-fieldset">
          <legend class="scheduler-border">Order Details</legend>

          <div class="inner-body">

            

            <form style='pointer-events: none; opacity: 0.5;' method="post" action="/refer_RadiologicalService/{{service_order.id}}/{{mycat.id}}" id="orderForm" multi readonly>
                {% csrf_token %} 

                    <div class="main-contact-info-body" style="padding: 0 !important;">
                        
                        <div class="form-group" style="margin-bottom: 0 !important;">
                        <div class=" mt-1 delimiter-top">
                            <div class="actions-toolbar py-2 mb-2">
                            <h6 class="mb-1">Tooth Selection</h6>
                            
                            <div class="row">
                                <div class="col-md-6">
                                  <div class="row">
                                      <div class="col-md-1 offset-sm-2 text-center image-enclosing--div">
                                        <label
                                            class="image-checkbox  "
                                            title="Italy"

                                        >
                                            <img
                                            src="{% static '/assets/img/tooth/18.jpg' %}"
                                            />
                                            <input
                                            type="checkbox"
                                            name="checks[]"
                                            id="18"
                                            value="18"
                                            />
                                        </label>
                                        <span class="image-aligned--span">18</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/17.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="17"
                                          value="17"
                                          />
                                        </label>
                                        <span class="image-aligned--span">17</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/16.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="16"
                                          value="16"
                                          />
                                        </label>
                                        <span class="image-aligned--span">16</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/15.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="15"
                                          value="15"
                                          />
                                        </label>
                                        <span class="image-aligned--span">15</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/14.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="14"
                                          value="14"
                                          />
                                        </label>
                                        <span class="image-aligned--span">14</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/13.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="13"
                                          value="13"
                                          />
                                        </label>
                                        <span class="image-aligned--span">13</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/12.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="12"
                                          value="12"
                                          />
                                        </label>
                                        <span class="image-aligned--span">12</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/11.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="11"
                                          value="11"
                                          />
                                        </label>
                                        <span class="image-aligned--span">11</span>
                                      </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="row">
                                      <div class="col-md-1 offset-sm-1 text-center  image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/21.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="21"
                                          value="18"
                                          />
                                        </label>
                                        <span class="image-aligned--span">21</span>
                                      </div>
                                      <div class="col-md-1 text-center  image-enclosing--div">
                                      <label
                                          class="image-checkbox  "
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/22.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="22"
                                          value="22"
                                          />
                                        </label>
                                        <span class="image-aligned--span">22</span>
                                      </div>
                                      <div class="col-md-1 text-center  image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/23.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          nname="checks[]"
                                          id="23"
                                          value="23"
                                          />
                                        </label>
                                        <span class="image-aligned--span">23</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/24.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="24"
                                          value="24"
                                          />
                                        </label>
                                        <span class="image-aligned--span">24</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/25.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="25"
                                          value="25"
                                          />
                                      </label>
                                      <span class="image-aligned--span">25</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/26.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="26"
                                          value="26"
                                          />
                                        </label>
                                        <span class="image-aligned--span">26</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/27.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="27"
                                          value="27"
                                          />
                                        </label>
                                        <span class="image-aligned--span">27</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/28.jpg' %}" style="height: 55px !important;"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="28"
                                          value="28"
                                          />
                                        </label>
                                        <span class="image-aligned--span">28</span>
                                      </div>
                                  </div>
                                </div>
                                <div class="col-md-6 mt-2">
                                  <div class="row">
                                      <div class="col-md-1 offset-sm-2 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/48.jpg' %}" style="height: 60px !important;"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="48"
                                          value="48"
                                          />
                                        </label>
                                        <span class="image-aligned--span">48</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/47.jpg' %}" style="height: 53px !important;"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="47"
                                          value="47"
                                          />
                                        </label>
                                        <span class="image-aligned--span">47</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/46.jpg' %}" style="height: 48px !important;"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="46"
                                          value="46"
                                          />
                                        </label>
                                        <span class="image-aligned--span">46</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/45.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="45"
                                          value="45"
                                          />
                                        </label>
                                        <span class="image-aligned--span">45</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/44.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="44"
                                          value="44"
                                          />
                                        </label>
                                        <span class="image-aligned--span">44</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/43.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="43"
                                          value="43"
                                          />
                                        </label>
                                        <span class="image-aligned--span">43</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/42.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="42"
                                          value="42"
                                          />
                                        </label>
                                        <span class="image-aligned--span">42</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/41.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="41"
                                          value="41"
                                          />
                                        </label>
                                        <span class="image-aligned--span">41</span>
                                      </div>
                                  </div>
                                </div>
                                <div class="col-md-6 mt-2">
                                  <div class="row">
                                      <div class="col-md-1 offset-sm-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/31.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="31"
                                          value="31"
                                          />
                                        </label>
                                        <span class="image-aligned--span">31</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/32.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="32"
                                          value="32"
                                          />
                                        </label>
                                        <span class="image-aligned--span">32</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/33.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="33"
                                          value="33"
                                          />
                                        </label>
                                        <span class="image-aligned--span">33</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/34.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="34"
                                          value="34"
                                          />
                                      </label>
                                      <span class="image-aligned--span">34</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/35.jpg' %}"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="35"
                                          value="35"
                                          />
                                        </label>
                                        <span class="image-aligned--span">35</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/36.jpg' %}" style="height: 48px !important;"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="36"
                                          value="36"
                                          />
                                        </label>
                                        <span class="image-aligned--span">36</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/37.jpg' %}" style="height: 49px !important;"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="37"
                                          value="37"
                                          />
                                        </label>
                                        <span class="image-aligned--span">37</span>
                                      </div>
                                      <div class="col-md-1 text-center image-enclosing--div">
                                      <label
                                          class="image-checkbox"
                                          title="Italy"
                                      >
                                          <img
                                          src="{% static '/assets/img/tooth/38.jpg' %}" style="height: 55px !important;"
                                          />
                                          <input
                                          type="checkbox"
                                          name="checks[]"
                                          id="38"
                                          value="38"
                                          />
                                      </label>
                                      <span class="image-aligned--span">38</span>
                                      </div>
                                </div>

                                <script src="{% static '/plugins/jquery/jquery.min.js' %}"></script>
                                <script type="text/javascript">
                                    jQuery(function ($) {
                                    // init the state from the input
                                    $(".image-checkbox").each(function () {
                                        if (
                                        $(this)
                                            .find('input[type="checkbox"]')
                                            .first()
                                            .attr("checked")
                                        ) {
                                        $(this).addClass(
                                            "image-checkbox-checked"
                                        );
                                        } else {
                                        $(this).removeClass(
                                            "image-checkbox-checked"
                                        );
                                        }
                                    });

                                    // sync the state to the input
                                    $(".image-checkbox").on(
                                        "click",
                                        function (e) {
                                        if (
                                            $(this).hasClass(
                                            "image-checkbox-checked"
                                            )
                                        ) {
                                            $(this).removeClass(
                                            "image-checkbox-checked"
                                            );
                                            $(this)
                                            .find('input[type="checkbox"]')
                                            .first()
                                            .removeAttr("checked");
                                        } else {
                                            $(this).addClass(
                                            "image-checkbox-checked"
                                            );
                                            $(this)
                                            .find('input[type="checkbox"]')
                                            .first()
                                            .attr("checked", "checked");
                                        }

                                        e.preventDefault();
                                        }
                                    );
                                    });
                                </script>
                                </div>
                            </div>
                            </div>
                        </div>
                        </div>

                        <div class="row">
                          <div class="col-4">
                              <div class="form-group">
                              <label class="form-control-label d-none"
                                  >Data Type</label
                              >
                              <select
                                  class="form-control"
                                  required
                                  name="title"
                                  id="title"
                                  onchange="onTypeChange()"
                              >
                                  <option selected="selected">
                                  Select Data Type
                                  </option>
                              </select>
                              </div>
                          </div>
                          <div class="col-4">
                              <div class="form-group">
                              <label class="form-control-label d-none"
                                  >Service Catagory</label
                              >
                              <select
                                  class="form-control"
                                  name="categ"
                                  id="categ"
                                  required
                                  onchange="onServiceChange()"
                              >
                                  <option selected="selected">
                                  Select Category
                                  </option>
                              </select>
                              </div>
                          </div>
                          <div class="col-4">
                              <div class="form-group">
                              <label class="form-control-label d-none">Price</label>
                              <input
                                  class="form-control"
                                  placeholder="Price"
                                  type="text"
                                  value=""
                                  name="price"
                                  id="price"
                                  readonly
                              />
                              </div>
                          </div>
                        
                        <!-- <div class="row"> -->
                          <div class="col-8">
                            <div class="form-group">
                            <label class="form-control-label d-none">Clinical Notes</label>
                            <input
                                class="form-control"
                                placeholder="Enter Clinical Notes"
                                type="text"
                                name="remark"
                                id="remark"
                            />
                            </div>
                          </div>
                          <div class="col-4 ">
                              <label class="form-control-label d-none"> </label>
                              <button onclick="myFcn()"
                                onmouseout="onAddButtonMouseOut()"
                                onmouseover="onAddButtonHover()"
                              type="submit"
                              class="btn btn-block ripple btn-primary"
                              id="addToOrderBtn"
                              >
                              Add to Order
                              </button>
                              <script>
                                function myFcn() {
                                  document.getElementById("myBtn").disabled = true;
                                }
                                </script>
                          </div>
                        </div>
                      </div>
                      
                      
                    </form>
                    <div class="row mt-2">
                <div class="col-12">

                  <div class="table-responsive" style="height: 150px;">
                    <table class="table">
                        <thead>
                            <tr style="text-allign:left !important;">
                                <th>Actions</th>
                                <th>Tooth Site(s)</th>
                                <th>Data Type</th>
                                <th>Service Category</th>
                                <th>Sub-Category</th>
                                <th>
                                  Price
                                  {% autoescape off %}
                                      {{icon}}
                                  {% endautoescape %}
                                </th>
                                <th>Remark</th>
                            </tr>
                        </thead>
                        <tbody">
                            <!-- for loop here  -->
                          {% for i in pros %}
                            <tr style="text-allign:left !important;">
                                <td style="width: 1px;">
                                  <a id="imageUploadBtn"  title="Upload Data" data-toggle="tooltip" data-placement="top" rel="tooltip" style="padding: 0;" type="button" class="btn action-icon--buttons primary-icon" onclick="imageUploadBtnClick({{i.id}})"  >
                                    <i class="fa-solid fa-cloud-arrow-up" data-toggle="modal" data-target="#exampleModalCenter" style="margin-top: 10px;"></i>
                                  </a>
                                                          
      
                                </td>
                                <td>{{ i.tooth }}</td>
                                <td>{{ i.data_type }}</td>
                                <td>{{ i.service_catagory }}</td>
                                <td>{{ i.finding_requires }}</td>
                                <td>{{ i.price }}</td>
                                <td>{{ i.remark }}</td>
                            </tr>
                          {% endfor %}
                        </tbody>
                    </table>
                </div>

                </div>
                <div class="d-none col-4 offset-sm-8 mt-3">
                  <button 
                  {% comment %} href="/patientdetails/{{patient.id}}" {% endcomment %}
                  onclick='history.back()'
                  class="btn btn-block ripple btn-primary"
                  >Back</button
              >
                </div>
            </div>
            <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" style="max-width: 60vw; " role="document">

                <div class="modal-content">

                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Upload Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                      <div class="row">

                        <div class="col-sm-12 col-lg-6">
                            <div class="card card-info">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="card-title">Upload CBCT / X-ray</h5>
                                </div>
                                <div class="card-body">
                                    <div class="container mt-3">
                                        <form action="/" method="post" class="dropzone dz" id="recommendationDiv">
                                            {% csrf_token %}
                                            <div class="fallback">
                                                <input name="file" id="file1" type="file" multiple/>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-sm-12 col-lg-6">
                            <div class="card card-info">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="card-title">Upload Patient Images</h5>
                                </div>
                                <div class="card-body">
                                    <div class="container mt-3">
                                        <form action="/" method="post" class="dropzone dz"
                                            id="form2">
                                            {% csrf_token %}
                                            <div class="fallback">
                                                <input name="file" id="file2" type="file"/>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                         
                      </div>
                      
                      <h6 style="
                      margin-top: 1.5rem;
                      color: #4b4b54;
                  "> Uploaded Files are: </h6>

                      <div class="table-responsive p-0" >
                        <table style="width: 100%;">
                          <thead>

                            <tr>
                              <th >
                                File Name
                              </th>
                              <th >
                                Actions
                              </th>
                            </tr>
                          </thead>
                          <tbody id='fileNameBody'>
                            {% comment %} {% for i in files %} {% endcomment %}
                              {% comment %} <tr>
                                  <td>{{ i.file }}</td>
                                  <td class="text-right py-0 align-middle">
                                      <div class="btn-group btn-group-sm">
                                          <a href="/{{i.file.url}}" target="_blank" class="btn btn-info"><i
                                                  class="fas fa-eye"></i></a>
                                          <a href="/ios_delete/{{i.id}}" class="btn btn-danger"><i
                                                  class="fas fa-trash"></i></a>
                                      </div>

                                  </td>
                              </tr> {% endcomment %}
                            {% comment %} {% endfor %} {% endcomment %}
                          </tbody>                            
                          </tr>
                        </table>
                        <style>

                          .back-button{
                            display: inline-flex;
                            width: 30px;
                            border: none;
                            background: white;
                            border-radius: 50%;
                            /* position: absolute; */
                            left: 1rem;
                            top: 1.2rem;
                            height: 30px;
                            justify-content: center;
                            align-items: center;
                          }

                          .back-button:hover{
                            background-color: #2f6ebb;
                            color: white;
                            
                          }

                          .floating-date-left{
                            position: absolute;
                            font-size: x-small;
                            color: black;
                            bottom: -17px;
                            left: 5px;
                          }
                          .floating-date-right{
                            position: absolute;
                            font-size: x-small;
                            color: black;
                            bottom: -17px;
                            right: 5px;
                          }
                          .admin-side--comment{
                            font-size: 14px;
                            position: relative;
                            margin: 17px 0;
                            background: #edede9;
                            border-color: #d0d0d0;
                            color: black;
                            padding: 3px 10px;
                            width: 60%;
                            border-top-right-radius: 10px;
                            border-bottom-right-radius: 10px;
                            border-radius: 10px;
                            border: 1px solid #d0d0d0;
                            margin-left: 10px;
                            overflow-wrap: break-word;
                            /* display: flex;
                            justify-content: space-between;
                            align-items: center; */
                          }
                          
                          .clinic-side--comment{
                            margin-right: 10px;
                            font-size: 14px;
                            position: relative;
                            margin: 17px 0;
                            background: #8ecae6;
                            color: black;
                            padding: 3px 3px 3px 10px;
                            width: 60%;
                            border-top-left-radius: 10px;
                            border-bottom-left-radius: 10px;
                            margin-left: auto;
                            border-radius: 10px;
                            margin-right: 10px;
                            border: 1px solid #d0d0d0;
                            overflow-wrap: break-word;
                          }
                          #case-chat{
                            height: 190px;
                            border: 1px solid #d0d0d0;  
                          }
                          th, td{
                            padding: 7px 0;
                          }
                          table.table.table-striped tr th{

                            text-align: center;
                          }
                          </style>
                      </div>
                  </div>
                  <script>
                      Dropzone.options.recommendationDiv = {
                      acceptedFiles: ".zip",
                      maxFiles:1,
                      init: function() {
                      this.hiddenFileInput.removeAttribute('multiple');
                  }
                  };
                  
                  </script>
                  <script>
                      Dropzone.options.form2 = {
                       acceptedFiles: ".stl,image/jpeg,image/png,image/gif",
                      maxFiles:2,
                      init: function() {
                        this.on("processing", function(file) {
                          this.options.url = getUrl('form2');
                        });
                        this.on("success", function(file){
                          if (file.previewElement) {
                            getFiles();
                            return file.previewElement.classList.add("dz-success");
                          }
                        });
                        this.on('resetFiles', function() {
                          if(this.files.length != 0){
                              for(i=0; i<this.files.length; i++){
                                  this.files[i].previewElement.remove();
                              }
                              this.files.length = 0;
                          }
                        });
                      this.hiddenFileInput.removeAttribute('multiple');
                      }
                  };
                  </script>
                  <script>
                    Dropzone.options.recommendationDiv = {
                      maxFilesize: 500,
                      init: function() {
                        this.on("processing", function(file) {
                          this.options.url = getUrl('form1');
                        });
                        this.on("uploadprogress", function(file, progress) {
                          console.log("File progress", progress);
                        })
                        this.on('resetFiles', function() {
                          if(this.files.length != 0){
                              for(i=0; i<this.files.length; i++){
                                  this.files[i].previewElement.remove();
                              }
                              this.files.length = 0;
                          }
                        });
                      }
                    };
                  
                  </script>

                  <!-- modal footer  -->

                  <div class="d-flex justify-content-end">
                    <button type="button" id="closeButton" style="background: #a3a3a326; border-color: #a3a3a326; color: black; font-weight: 500; margin: 10px 0; margin-right: 1rem; border-radius: 3px; border-width: thin;" data-dismiss="modal">Close</button>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </fieldset>
      </div>
    </div>
  </div>
</div>
<input id="service_orderid" name="service_orderid" value="{{service_order.id}}" hidden>
<input id="topcat_id" name="topcat_id" value="{{mycat.id}}" hidden>
<style>
  fieldset.scheduler-border {
    border: 1px groove #ddd !important;
    padding: 0 1em 1em 1.3em !important;
    margin: 0 0 1.5em 0 !important;
    -webkit-box-shadow: 0px 0px 0px 0px #000;
    box-shadow: 0px 0px 0px 0px #000;
    background-color: white;
  }

  legend.scheduler-border {
    font-size: 1.2em !important;
    font-weight: bold !important;
    text-align: left !important;
    width: auto;
    padding: 0 10px;
    border-bottom: none;
    color: #1f3f7f;
    border: 1px solid;
    background: white;
  }

  .table-heading--style {
    font-weight: 500;
    padding: 0.75rem 0.5rem 0 0;
  }

  .table-data--style {
    color: #414141;
    padding: 0.75rem 0 0 0.5rem;
  }

  #main-header--top{
    display: none;
  }

  .image-checkbox {
    cursor: pointer;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    border: 4px solid transparent;
    outline: 0;
  }

  .image-checkbox input[type="checkbox"] {
    display: none;
  }

  .image-checkbox-checked {
    border-color: #2f6ebb;
  }
  div label img{
    max-width: 18px;
  }

  #example2_info{
    margin-bottom: 0;
  }

  table.dataTable thead th{
    padding: 5px 10px !important;
  } 

  .table td{
    padding: 1px 15px !important;
  }

  .image-enclosing--div{
    display: flex;
    /* border: 1px solid black; */
    justify-content: space-between;
    flex-direction: column;
    align-items: center;
  }

  #example2_filter {
    display: flex !important;
    justify-content: end !important;
    text-align: end;
  }

  #example2_wrapper>div:nth-child(2) {
    overflow-x: auto !important;
  }

  /* th.sorting, td{
        display:  table-cell !important;
    } */
    small, .small{
        font-size: 14px !important;
        
    }

    #example2_filter{
        display: flex !important;
        justify-content: end !important;
        text-align: end;
    }

    #example2_wrapper>div:nth-child(2) {
        overflow-x:auto !important;
    }

    a.action-icon--buttons.primary-icon{
      color: #8f9cc4;
    }

    a.action-icon--buttons.primary-icon:hover{
      color: #1f3f7f;
    }
    a.action-icon--buttons.danger-icon:hover{
      color: red;
    }

    {% comment %} table.table tr{
        text-align: center;
    } {% endcomment %}
    table.table{
        width: 100%;
        margin: 0 auto 0.5rem auto;
        border: 1px solid #eaedf7;
        
    }
    div.table-responsive table.table thead tr:first-child{
      background-color: #2f6ebb;
      color: white;
      /* white-space: ; */
    }
    div.table-responsive table.table thead tr:first-child th{
      color: white;
    }

    div.table-responsive table.table tr, th{
      white-space: nowrap;
      /* color: white; */
    }

  /* #patient-fieldset{
    height: 25vh;
  } */

  /* #summary-fieldset{
    height: 62vh;
  }
  #order-fieldset{
    height: 90vh;
  } */

</style>


<script src="{% static '/plugins/jquery/jquery.min.js' %}"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>

let parent=  document.getElementById('case-chat')

  {% for i in comment %}
    {% comment %} console.log('inner', {{i.name}}, {{i.comment}}); {% endcomment %}
    var ele= document.createElement('div');

    var date= document.createElement('span');
    date.innerText=`{{i.date}}`;

    
    var text= document.createElement('span');
    text.innerText= `{{i.comment}}`
    
    console.log('the elemet created is', ele);

    if(`{{i.orgid}}`=='{{org}}'){
    
      date.classList.add('floating-date-right');
      ele.appendChild(date);
      ele.appendChild(text);
      
      ele.classList.add('clinic-side--comment');
    }    
    else{
      date.classList.add('floating-date-left');
      ele.appendChild(text);
      ele.appendChild(date);
  
      ele.classList.add('admin-side--comment')
        
    }    
    parent.appendChild(ele);           

  {% endfor %}

  const type = [{% for i in studies %} '{{ i.title | escapejs }}', {% endfor %}];
  const service = [{% for i in studies %} '{{ i.maincat | escapejs }}', {% endfor %}];
  const prices = [{% for i in studies %} '{{ i.price | escapejs }}', {% endfor %}];

  let main_fetch = {};


  // for loop converts these above mentioned three arrays into an object of arrays and those arrays containing other objects
  for (let i = 0; i < type.length; i++) {

    let demo1 = service[i];
    let demo2 = prices[i];
    let ob = {};
    ob[demo1] = demo2;
    let ef = type[i].trim();
    if (main_fetch[ef]) {
        main_fetch[ef] = [...main_fetch[ef], ob];
    }
    else {
        main_fetch[ef] = [ob];
    }
  }
  //consoling the main_fetch
  console.log('Im thhhhhhh', main_fetch);

  // selecting the 'type' id
  const sel1 = document.getElementById('title');

  //picks up the keys from main_fetch
  let keys = Object.keys(main_fetch);

  //appends the DOM keys to the select
  for (let j = 0; j < keys.length; j++) {
      let opt = document.createElement('option');
      opt.value = keys[j];
      opt.innerHTML = keys[j];
      sel1.appendChild(opt);
  }


  // function for type change
  function onTypeChange() {

      let typeVal = document.getElementById('title').value;

      let serviceSelect = document.getElementById('categ');

      while (serviceSelect.options.length > 0) {
          serviceSelect.remove(0);
      }


      if (typeVal == 'CBCT') {
          let extracted = main_fetch['CBCT'].map(ob => Object.keys(ob));
          let opt = document.createElement('option');
          opt.value = 'select';
          opt.innerHTML = 'Select';
          serviceSelect.prepend(opt);
          for (let inner of extracted) {
              let opt = document.createElement('option');
              opt.value = inner;
              opt.innerHTML = inner;
              serviceSelect.appendChild(opt);
          }
      }
      else if (typeVal == 'X-Ray') {
          let extracted = main_fetch['X-Ray'].map(ob => Object.keys(ob)[0]);
          let opt = document.createElement('option');
          opt.value = 'select';
          opt.innerHTML = 'Select';
          serviceSelect.prepend(opt);
          for (let inner of extracted) {

              let opt = document.createElement('option');
              opt.value = inner;
              opt.innerHTML = inner;
              serviceSelect.appendChild(opt);
          }

      }
      else {
          let p = document.getElementById('price');
          let op = document.createElement('option');
          op.value = 'Select Category';
          op.innerHTML = 'Select Catagory';
          serviceSelect.appendChild(op);
          p.value = null;
      }
  }

  //function for service Change
  function onServiceChange() {
      let typeVal = document.getElementById('title').value;
      let serviceVal = document.getElementById('categ').value;
      let priceSelect = document.getElementById('price');
      let result = false;
      for (let obj of main_fetch[typeVal]) {
          if (Object.keys(obj)[0] == serviceVal) {
              priceSelect.value = Object.values(obj)[0];
              result = true;
              break;
          }
      }
      if (result == false) {
          priceSelect.value = null;
      }
  }

  

</script>
<script src="{% static '/ajax/jquery.js' %}"></script>

<script>
  var lineOrderId='' ; 
  function imageUploadBtnClick(id){
    lineOrderId = id;
    var fm2 = Dropzone.forElement("form#form2");
    console.log(fm2);
    //"resetFiles" Event Call
    fm2.emit("resetFiles");

    var fm1 = Dropzone.forElement("form#recommendationDiv");
    console.log(fm1);
    //"resetFiles" Event Call
    fm1.emit("resetFiles");

    document.querySelectorAll('div.dz-default.dz-message')[0].style.display='block';
    document.querySelectorAll('div.dz-default.dz-message')[1].style.display='block';

    getFiles();
  }
  // ajax call function 
  function getFiles(){
    let pk =$('#service_orderid').val();
    let id1 = lineOrderId;
    let csr = $("input[name=csrfmiddlewaretoken]").val();    
    mydata={'pk': pk,'id1': id1, 'csrfmiddlewaretoken': csr};
    let f= document.getElementById('fileNameBody');
    while (f.hasChildNodes()) {
      f.removeChild(f.firstChild);
    }

    $.ajax(
      {
        url: `/viewImage/${pk}/${id1}`,
        method:'GET',
        data: mydata,
        success: function (data) {
          if(data.length>0){

            console.log("the data is", data[0]['id'])
            
            var main_id= data[0]['id'];
            $( data ).each(function(i) {
              var fileName1 = data[i]['file'].match(/[ \w-]+\.[\w-]*$/)[0];
              var table_row= document.createElement('tr');
              var table_heading= document.createElement('td');
              var table_heading2= document.createElement('td');

              var anchor= document.createElement('a');
              anchor.classList.add('btn');
              // anchor.type='button';
              anchor.href=`/ios_delete/${main_id}`;
              
              var icon= document.createElement('i');
              icon.classList.add("fa-solid", "fa-trash");
              
              anchor.appendChild(icon);
              
              table_heading.innerText= fileName1;
              table_heading2.appendChild(anchor);
              table_row.appendChild(table_heading);
              table_row.appendChild(table_heading2);
              f.appendChild(table_row);
            }); 
          }
        }
      });
    }
  
  function getUrl(name){
    if(name=='form2'){
      return `/updateimageFile/{{service_order.id}}/${lineOrderId}`;
    } else{
      return `/updateDcmFileRadio/{{ service_order.id }}/${lineOrderId}`;
    }
   }

  function onAddButtonHover(){
    console.log('entered buttonhover');
    if(document.getElementById('title').value=='Select Data Type' || document.getElementById('categ').value=='Select Category' || document.getElementById('categ').value=='select'){
      {% comment %} document.getElementById('addToOrderBtn').style.cursor='not-allowed'; {% endcomment %}
      document.getElementById('addToOrderBtn').disabled=true;
      console.log('entered buttonhover and changed style');
    }
    console.log('last statement in button over');
  }
  function onAddButtonMouseOut(){
    console.log('entered mouse out');
    {% comment %} document.getElementById('addToOrderBtn').style.cursor='pointer'; {% endcomment %}
    document.getElementById('addToOrderBtn').disabled=false;
    console.log('entered mouse out and  changed style')
    
  }

</script>

<script>
  window.alert = (function () {
    var nativeAlert = window.alert;
    return function (message) {
      window.alert = nativeAlert;
      message.indexOf("DataTables warning") === 0
        ? console.warn(message)
        : nativeAlert(message);
    };
  })();
</script>
<script>
  $(function () {
    $("#example2").DataTable({
      order: [[1, "desc"]],
      paging: false,
      lengthChange: false,
      searching: false,
      ordering: true,
      info: true,
      autoWidth: false,
      responsive: true,
    });
  });

</script>


{% endif %}
{% endblock %}
