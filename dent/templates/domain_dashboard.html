{% extends 'domain_dashbase.html' %}
{% load static %}
{% block content %}
{% if user.is_authenticated %}

<style>
    body{
        padding-left: 80px;
    }
    .main-content.side-content.pt-0{
        margin: 0 auto;
    }
	.my {
	
	  border-radius: 5px;
	  height:25px
	}
	
	.my:hover {
	  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
	}
	
	
	</style>
	<div class="main-content side-content pt-0">
					<div class="container-fluid">
						<div class="inner-body">
							<div class="page-header" style='display:none'>
							{% comment %} <div class="page-header" > {% endcomment %}
								<div>
									<h4 class="text-primary" >Home</h4>
	
								</div>
								<div class="d-flex">
									<div class="justify-content-center">
										
									</div>
								</div>
							</div>
	
							<!-- Page Header -->
	
							<!-- End Page Header -->
	
	
							<!--Row-->
							<div class="row row-sm justify-content-center">
								<div class="col-sm-12 col-lg-12 col-xl-12 mt-5">
	
									<!--Row-->
									<div class="row row-sm  mt-lg-4">
										<div class="col-sm-12 col-lg-12 col-xl-12">
											<div class="card bg-primary custom-card card-box">
												<div class="card-body p-4">
													<div class="row align-items-center">
														<div class="offset-xl-3 offset-sm-6 col-xl-8 col-sm-6 col-12 img-bg ">
															<h4 class="d-flex  mb-3">
																<span class="font-weight-bold text-white ">Hello {{usr.name}}!</span>
																<!-- if user is Admin Clinic  -->
																{% if usr.department == 'Admin' %}
																
																	<form action="" method="post"  class="ml-auto">
																		<select style="font-size: medium;  padding: 3px 10px; border-radius: 3px; font-weight: 100;">
																			
																			<!-- for loop here for all branches  -->
																			<option value="select">Select</option>
																			{% for i in branch %}
																			<option name={{i.orgname}} value={{i.id}}>{{i.orgname}}</option>
																			{% endfor %}
																			<option value="All">All</option>
																			<!-- for loop ends here  -->
																		</select>
																	</form>
																<!-- if ends here  -->
																{% endif %}
																
																{% if usr.department != 'Admin' %}
																	<span class="ml-auto" style="color: white">
																		{{org.orgname}} 
																	</span>
																{% endif %}
																<!-- else loop ends here  -->
															</h4>
	
														</div>
														<img src="{% static '/dentread/assets/img/pngs/work3.png' %}" alt="user-img" class="wd-200">
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
									<!--Row -->
	
									<!--Row-->
	
									<!-- styled none -->
								<div class="col-sm-12 col-lg-12 col-xl-12">
									<div class="row row-sm" style="display: none;">
										<div class="col-sm-12 col-md-6 col-lg-6 col-xl-4">
											<div class="card custom-card">
												<div class="card-body">
													<div class="card-item">
														<div class="card-item-icon card-icon">
															<svg class="text-primary" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><g><rect height="14" opacity=".3" width="14" x="5" y="5"/><g><rect fill="none" height="24" width="24"/><g><path d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M19,19H5V5h14V19z"/><rect height="5" width="2" x="7" y="12"/><rect height="10" width="2" x="15" y="7"/><rect height="3" width="2" x="11" y="14"/><rect height="2" width="2" x="11" y="10"/></g></g></g></svg>
														</div>
														<div class="card-item-title mb-2">
															<label class="main-content-label tx-13 font-weight-bold mb-1">Appointments</label>
															<span class="d-block tx-12 mb-0 text-muted"></span>
														</div>
														<div class="card-item-body">
															<div class="card-item-stat">
																<h4 class="font-weight-bold">{% if appointment is not None %}{{appointment}}{% endif %}{% if appointment is  None %}0{% endif %}</h4>
	
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="col-sm-12 col-md-6 col-lg-6 col-xl-4">
											<div class="card custom-card">
												<div class="card-body">
													<div class="card-item">
														<div class="card-item-icon card-icon">
															<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 4c-4.41 0-8 3.59-8 8 0 1.82.62 3.49 1.64 4.83 1.43-1.74 4.9-2.33 6.36-2.33s4.93.59 6.36 2.33C19.38 15.49 20 13.82 20 12c0-4.41-3.59-8-8-8zm0 9c-1.94 0-3.5-1.56-3.5-3.5S10.06 6 12 6s3.5 1.56 3.5 3.5S13.94 13 12 13z" opacity=".3"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM7.07 18.28c.43-.9 3.05-1.78 4.93-1.78s4.51.88 4.93 1.78C15.57 19.36 13.86 20 12 20s-3.57-.64-4.93-1.72zm11.29-1.45c-1.43-1.74-4.9-2.33-6.36-2.33s-4.93.59-6.36 2.33C4.62 15.49 4 13.82 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8c0 1.82-.62 3.49-1.64 4.83zM12 6c-1.94 0-3.5 1.56-3.5 3.5S10.06 13 12 13s3.5-1.56 3.5-3.5S13.94 6 12 6zm0 5c-.83 0-1.5-.67-1.5-1.5S11.17 8 12 8s1.5.67 1.5 1.5S12.83 11 12 11z"/></svg>
														</div>
														<div class="card-item-title mb-2">
															<label class="main-content-label tx-13 font-weight-bold mb-1">Patient Registrations</label>
															<span class="d-block tx-12 mb-0 text-muted"></span>
														</div>
														<div class="card-item-body">
															<div class="card-item-stat">
																<h4 class="font-weight-bold">{% if patient is not None %}{{patient}}{% endif %}{% if patient is  None %}0{% endif %}</h4>
	
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="col-sm-12 col-md-12 col-lg-12 col-xl-4">
											<div class="card custom-card">
												<div class="card-body">
													<div class="card-item">
														<div class="card-item-icon card-icon">
															<svg class="text-primary" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8zm1.23 13.33V19H10.9v-1.69c-1.5-.31-2.77-1.28-2.86-2.97h1.71c.09.92.72 1.64 2.32 1.64 1.71 0 2.1-.86 2.1-1.39 0-.73-.39-1.41-2.34-1.87-2.17-.53-3.66-1.42-3.66-3.21 0-1.51 1.22-2.48 2.72-2.81V5h2.34v1.71c1.63.39 2.44 1.63 2.49 2.97h-1.71c-.04-.97-.56-1.64-1.94-1.64-1.31 0-2.1.59-2.1 1.43 0 .73.57 1.22 2.34 1.67 1.77.46 3.66 1.22 3.66 3.42-.01 1.6-1.21 2.48-2.74 2.77z" opacity=".3"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z"/></svg>
														</div>
														<div class="card-item-title  mb-2">
															<label class="main-content-label tx-13 font-weight-bold mb-1">Total Business</label>
															<span class="d-block tx-12 mb-0 text-muted"></span>
														</div>
														<div class="card-item-body">
															<div class="card-item-stat">
																<h4 class="font-weight-bold">INR {% if amount is not None %}{{amount}}{% endif %}{% if amount is  None %}0{% endif %}</h4>
	
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
									<!--End row-->
	
									<!--row-->
									<div class="row row-sm">
	
										<div class="col-lg-12">
											<div class="card custom-card mg-b-20">
												<div class="card-body">
													<div class="card-header border-bottom-0 pt-0 pl-0 pr-0 d-flex">
														<div style="margin: auto 0;">
															{% if usr.department == 'Admin' or usr.department == 'Manager' %}
																<label class="main-content-label mb-2">Referred Cases</label> 
															{% endif %}
															<!-- else loop here  -->
															{% if usr.department != 'Admin' and usr.department != 'Manager' %}
																<label class="main-content-label mb-2">Cases referred  by {user name}</label> 
															{% endif %}	
															<!-- else loop ends  -->
														</div>
														<div class="d-flex" style="margin-left: auto;">
															<div class="justify-content-center">
																<div class="btn btn-list">
																	<form method="post" action="/login_domain">
																		{% csrf_token %}
								
																			<div aria-label="Basic example"
																					class="btn btn-group date-filters" role="group">
																				<input name="query_date" id="query_date" hidden>
																				<button class="btn ripple pd-x-25"
																						type="radio" value="today" id='todayFilter' style="border-top-left-radius: 3px; border-bottom-left-radius: 3px; border: 1px solid;"
																						onclick="todayFunction()" {{check1}}>Today
																				</button>
																				<button class="btn ripple pd-x-25"
																						type="radio" value="yesterday" id='yesterdayFilter' style='border: 1px solid; border-left:none'
																						onclick="yesterdayFunction()" {{check2}}>
																					Yesterday
																				</button>
																				<button class="btn ripple pd-x-25" style='border: 1px solid; border-left:none' 
																						type="radio" value="thisweek" id='thisweekFilter'
																						onclick="thisweekFunction()" >This
																					Week
																				</button>
																			</div>
																		</form>
																		<script>
																			
																			let todayFunction= function () {
																				document.getElementById("query_date").value='today';
																				console.log('inside today')
																			}
																			let yesterdayFunction= function () {
																				document.getElementById("query_date").value = 'yesterday';
																				console.log('inside yesterday')
																			}
																			let thisweekFunction= function () {
																				document.getElementById("query_date").value = 'thisweek';
																				console.log('inside thisweek')
																			}
																			if(`{{btnchecked}}`=='todayFunction'){
																				document.getElementById('todayFilter').classList.add('btn-primary')
																				document.getElementById('todayFilter').style.border='none'
																			}
																			if(`{{btnchecked}}`=='yesterdayFunction'){
																				document.getElementById('yesterdayFilter').classList.add('btn-primary')
																				document.getElementById('yesterdayFilter').style.border='none'
																			}
																			if(`{{btnchecked}}`=='thisweekFunction'){
																				document.getElementById('thisweekFilter').classList.add('btn-primary')
																				document.getElementById('thisweekFilter').style.border='none'
																			}
																		</script>															
																</div>
															</div>
														</div>
														<style>
															.btn-list{
																margin-bottom: 0;
															}
														</style>
													</div>
													<div class="table-responsive tasks">
														<table class="table card-table table-vcenter text-nowrap mb-0  border">
															<thead>
																<tr>
																	<th class="wd-lg-10p">Service</th>
																	<th class="wd-lg-20p">Total</th>
																	<th class="wd-lg-20p">Pending</th>
																	<th class="wd-lg-20p">In-Process</th>
																	<th class="wd-lg-20p">Completed</th>
																</tr>
															</thead>
															<tbody onclick="onNumberClick(event)">
																<tr class="radiological">
																	<td class="font-weight-semibold d-flex"><label class="ckbox my-auto mr-4 mt-1"><input checked="" type="checkbox"><span></span></label><span class="mt-1">Radiological Report</span></td>
																	<td class="total"><span class="badge badge-pill badge-primary-light">{{radio_total}}</span></td>
																	<td class="pending"><span class="badge badge-pill badge-warning-light">{{radio_pending}}</span></td>
																	<td class="in-progress"><span class="badge badge-pill badge-info-light">{{radio_inprogress}}</span></td>
																	<td class="completed"><span class="badge badge-pill badge-success-light">{{radio_completed}}</span></td>
																</tr>
																<tr class="image-analysis">
																	<td class="font-weight-semibold d-flex"><label class="ckbox my-auto mr-4 mt-1"><input checked="" type="checkbox"><span></span></label><span class="mt-1">Image Analysis Report</span></td>
																	<td class="total"><span class="badge badge-pill badge-primary-light">{{image_total}}</span></td>
																	<td class="pending"><span class="badge badge-pill badge-warning-light">{{image_pending}}</span></td>
																	<td class="in-progress"><span class="badge badge-pill badge-info-light">{{image_inprogress}}</span></td>
																	<td class="completed"><span class="badge badge-pill badge-success-light">{{image_completed}}</span></td>
																</tr>
																<tr class="implant-planning">
																	<td class="font-weight-semibold d-flex"><label class="ckbox my-auto mr-4 mt-1"><input checked="" type="checkbox"><span></span></label><span class="mt-1">Implant Planning Report</span></td>
																	<td class="total"><span class="badge badge-pill badge-primary-light">{{planning_total}}</span></td>
																	<td class="pending"><span class="badge badge-pill badge-warning-light">{{planning_pending}}</span></td>
																	<td class="in-progress"><span class="badge badge-pill badge-info-light">{{planning_inprogress}}</span></td>
																	<td class="completed"><span class="badge badge-pill badge-success-light">{{planning_completed}}</span></td>
																</tr>
																<tr class="implant-surgicalGuide">
																	<td class="font-weight-semibold d-flex"><label class="ckbox my-auto mr-4 mt-1"><input checked="" type="checkbox"><span></span></label><span class="mt-1">Implant Surgical Guide</span></td>
																	<td class="total"><span class="badge badge-pill badge-primary-light">{{guide_total}}</span></td>
																	<td class="pending"><span class="badge badge-pill badge-warning-light">{{guide_pending}}</span></td>
																	<td class="in-progress"><span class="badge badge-pill badge-info-light">{{guide_inprogress}}</span></td>
																	<td class="completed"><span class="badge badge-pill badge-success-light">{{guide_completed}}</span></td>
																</tr>
															</tbody>
														</table>
													</div>
												</div>
											</div>
										</div><!-- col end -->
									</div><!-- Row end -->
								</div><!-- col end -->
	
								<!-- if admin or manager  -->
	
								{% if usr.department == 'Admin' or usr.department == 'Manager' %}
	
									<div class="col-sm-12 col-lg-12 col-xl-4 d-flex">
										
	
										<div class="card custom-card card-dashboard-calendar pb-0 d-none" style="flex: 1;">
	
											<div class="card-header border-bottom-0" style='padding: 0 !important'>
												<label class="main-content-label my-auto pt-2">Dentread Payable</label>
												<span class="d-block tx-12 mb-0 mt-1 text-muted"></span> 
											</div>
	
											<div class="card custom-card" style="margin-top: 1.0rem;">
												<div class="card-body">
													<div class="card-item">
														
														
														<div class="card-item-body">
															<div class="card-item-stat">
																<h4 class="font-weight-bold">INR {% if amount is not None %}{{amount}}{% endif %}{% if amount is  None %}0{% endif %}</h4>
	
															</div>
														</div>
														<div class="card-item-icon card-icon">
															<svg class="text-primary" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8zm1.23 13.33V19H10.9v-1.69c-1.5-.31-2.77-1.28-2.86-2.97h1.71c.09.92.72 1.64 2.32 1.64 1.71 0 2.1-.86 2.1-1.39 0-.73-.39-1.41-2.34-1.87-2.17-.53-3.66-1.42-3.66-3.21 0-1.51 1.22-2.48 2.72-2.81V5h2.34v1.71c1.63.39 2.44 1.63 2.49 2.97h-1.71c-.04-.97-.56-1.64-1.94-1.64-1.31 0-2.1.59-2.1 1.43 0 .73.57 1.22 2.34 1.67 1.77.46 3.66 1.22 3.66 3.42-.01 1.6-1.21 2.48-2.74 2.77z" opacity=".3"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z"/></svg>
														</div>
													</div>
												</div>
											</div>
	
										</div>
										<div class="card custom-card card-dashboard-calendar pb-0 d-none" style="height: 250px;">
	
	
	
											<!-- cloud usage code begins here  -->
											<div class="card-header border-bottom-0" style='padding: 0 !important'>
												<label class="main-content-label my-auto pt-2">Cloud Usage  <i class="fa fa-cloud" style="font-size: 20px; color: blue; margin-left:1rem"></i></label>
												<!-- <span class="d-block tx-12 mb-0 mt-1 text-muted"></span> -->
											</div>
											<div style='display: flex'>
												<div class="card-body crypto-wallet" style='width: 180px'>
													<div class="">
														<canvas id="crypto-donut" class="ht-200-f "></canvas></div>
														<div class="chart-circle-value circle-style" style='top:30px !important; margin-left: 2rem !important;'><div class="tx-20 font-weight-bold" id='available_data_percent'>55%</div>
													</div>
												</div>
	
												<div style='margin-right: 1.5rem; margin-top: 2.3rem'>
													
													<table class="table border-0 mg-b-0 text-nowrap text-md-nowrap">
														<tbody>
															<tr>
																<td>
																	Allocated
																</td>
																<th>
																	2 GB
																</th>
															</tr>
															<tr>
																<td>
																	Consumed
																</td>	
																<th id='consumed_data'>
																	0.5 GB
																</th>
															</tr>
															<tr>
																<td>
																	Available
																</td>	
																<th id='available_data'>
																	0.5 GB
																</th>
															</tr>
														</tbody>
													</table>
												</div>
	
											</div>
										</div>
									</div>
	
								{% endif %}	
	
								<!-- if loop ends here  -->
	
							</div>
						</div>
					</div>
				</div>
			<!-- </div>
	</div> -->
	<style>
		.card-item .card-item-icon{
			top: -1rem !important;
		}
	</style>
	<script>
		let consumed_data= Math.floor("{{final_total_size}}"/(1024*1024))
		let available_data= parseInt(2048-consumed_data);
		let available_data_percent= parseInt((available_data/2048)*100);
		document.getElementById('consumed_data').innerText= `${consumed_data} MB`;
		document.getElementById('available_data').innerText= `${available_data} MB`;
		document.getElementById('available_data_percent').innerText= `${available_data_percent}%`;
	

		// service, status, date
		function onNumberClick(event){
			
			if(event.target.tagName == 'SPAN' && event.target.innerText >0){
				console.log(event.target);
				let status = '';
				let service = '';
				let date = ''
				if(event.target.parentElement.classList.contains('total')){
					status = 'total'
				}
				else if(event.target.parentElement.classList.contains('pending')){
					status = 'Pending'
				}
				else if(event.target.parentElement.classList.contains('in-progress')){
					status = 'In Process'
				}
				else if(event.target.parentElement.classList.contains('completed')){
					status = 'Completed'
				}
				console.log(status);

				if(event.target.parentElement.parentElement.classList.contains('radiological')){
					service = 'Radiological Report'
				}
				else if(event.target.parentElement.parentElement.classList.contains('image-analysis')){
					service = 'Image Analysis Report'
				}
				else if(event.target.parentElement.parentElement.classList.contains('implant-planning')){
					service = 'Implant Planning Report'
				}
				else if(event.target.parentElement.parentElement.classList.contains('implant-surgicalGuide')){
					service = 'Implant Surgical Guide'
				}
				else{
					service = 'Digital Lab Services'
				}
				console.log(service)

				for(let x of document.getElementsByClassName('date-filters')[0].children){
					if(x.tagName == 'BUTTON' && x.classList.contains('btn-primary')){
						date = x.innerText;
					}
				} 
				console.log(date);
				document.location.href = `/directTargetedStatusToDentread/${service}/${status}/${date}`;
				// url should be changed here 
			}
		}
	</script>
				<!-- End Main Content-->
	

{% endif %}
{% endblock %}